{% extends "base.html" %}

{% block title %}ç§‘æŠ€ç®€æŠ¥ - {{ date[:4] }}-{{ date[4:6] }}-{{ date[6:] }}{% endblock %}

{% block content %}
<div class="min-h-screen">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-10">
        
        <!-- Back Link -->
        <div class="mb-6 sm:mb-8 animate-fade-in">
            <a href="/" class="inline-flex items-center gap-2 text-white/50 hover:text-white transition-colors group">
                <svg class="w-5 h-5 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                <span>è¿”å›é¦–é¡µ</span>
            </a>
        </div>
        
        <!-- Header -->
        <header class="glass rounded-2xl sm:rounded-3xl p-6 sm:p-10 mb-8 sm:mb-12 animate-slide-up">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <div class="flex items-center gap-3 mb-3">
                        <span class="text-3xl sm:text-4xl">ğŸ“°</span>
                        <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-white">æ¯æ—¥å…¨çƒç§‘æŠ€ç®€æŠ¥</h1>
                    </div>
                    <p class="text-xl sm:text-2xl gradient-text font-semibold">{{ date[:4] }}å¹´{{ date[4:6] }}æœˆ{{ date[6:] }}æ—¥</p>
                </div>
                <div class="text-left sm:text-right">
                    <p class="text-xs sm:text-sm text-white/40 mb-1">æ›´æ–°æ—¶é—´</p>
                    <p class="text-white/70 font-medium">{{ briefing.get('generated_at', '06:00 AM') }}</p>
                </div>
            </div>
        </header>
        
        {% if briefing.get('articles_by_category') or briefing.get('articles') %}
        
        <!-- Overview Stats -->
        <section class="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 mb-8 sm:mb-12 animate-slide-up" style="animation-delay: 0.1s">
            <div class="stat-card rounded-2xl p-5 sm:p-6 text-center">
                <p class="text-3xl sm:text-4xl font-bold gradient-text mb-1">{{ briefing.total_articles or 0 }}</p>
                <p class="text-xs sm:text-sm text-white/50">æ–°é—»æ€»æ•°</p>
            </div>
            <div class="stat-card rounded-2xl p-5 sm:p-6 text-center">
                <p class="text-3xl sm:text-4xl font-bold gradient-text mb-1">{{ briefing.categories_count or 12 }}</p>
                <p class="text-xs sm:text-sm text-white/50">è¦†ç›–ç±»åˆ«</p>
            </div>
            <div class="stat-card rounded-2xl p-5 sm:p-6 text-center">
                <p class="text-3xl sm:text-4xl font-bold gradient-text mb-1">{{ briefing.sources_count or '20+' }}</p>
                <p class="text-xs sm:text-sm text-white/50">æ–°é—»æ¥æº</p>
            </div>
            <div class="stat-card rounded-2xl p-5 sm:p-6 text-center">
                <p class="text-3xl sm:text-4xl font-bold gradient-text mb-1">{{ briefing.predictions|length if briefing.predictions else 12 }}</p>
                <p class="text-xs sm:text-sm text-white/50">é¢„æµ‹åˆ†æ</p>
            </div>
        </section>
        
        <!-- Summary -->
        {% if briefing.get('summary') %}
        <section class="glass rounded-2xl sm:rounded-3xl p-6 sm:p-8 mb-8 sm:mb-12 animate-slide-up" style="animation-delay: 0.2s">
            <h2 class="text-lg sm:text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <span class="text-xl">ğŸ“</span> ä»Šæ—¥è¦ç‚¹
            </h2>
            <p class="text-white/70 leading-relaxed text-sm sm:text-base">{{ briefing.summary }}</p>
        </section>
        {% endif %}
        
        <!-- Articles by Category -->
        {% for category, articles in briefing.articles_by_category.items() if articles %}
        <section class="glass rounded-2xl sm:rounded-3xl p-6 sm:p-8 mb-6 sm:mb-8 animate-slide-up" style="animation-delay: {{ 0.3 + loop.index * 0.1 }}s">
            <h2 class="text-xl sm:text-2xl font-bold text-white mb-6 sm:mb-8 flex items-center gap-3">
                <span class="text-2xl sm:text-3xl">
                    {% if category == 'ai' %}ğŸ¤–{% elif category == 'robotics' %}ğŸ¦¾{% elif category == 'embodied_ai' %}ğŸ‘“{% elif category == 'semiconductor' %}ğŸ’¾{% elif category == 'auto' %}ğŸš—{% elif category == 'health' %}ğŸ¥{% elif category == 'economy' %}ğŸ“Š{% elif category == 'business' %}ğŸ’¼{% elif category == 'politics' %}ğŸ›ï¸{% elif category == 'investment' %}ğŸ“ˆ{% elif category == 'consumer_electronics' %}ğŸ“±{% elif category == 'key_people' %}ğŸ¤{% else %}ğŸ“Œ{% endif %}
                </span>
                <span>
                    {% if category == 'ai' %}AI{% elif category == 'robotics' %}æœºå™¨äºº{% elif category == 'embodied_ai' %}å…·èº«æ™ºèƒ½{% elif category == 'semiconductor' %}åŠå¯¼ä½“{% elif category == 'auto' %}æ±½è½¦{% elif category == 'health' %}åŒ»ç–—å¥åº·{% elif category == 'economy' %}ç»æµæ”¿ç­–{% elif category == 'business' %}å•†ä¸šç§‘æŠ€{% elif category == 'politics' %}æ”¿æ²»æ”¿ç­–{% elif category == 'investment' %}æŠ•èµ„è´¢ç»{% elif category == 'consumer_electronics' %}æ¶ˆè´¹ç”µå­{% elif category == 'key_people' %}å…³é”®äººç‰©{% else %}{{ category }}{% endif %}
                </span>
                <span class="text-sm font-normal text-white/40 ml-1">({{ articles|length }})</span>
            </h2>
            
            <div class="space-y-4 sm:space-y-6">
                {% for article in articles %}
                <article class="article-card p-5 sm:p-6">
                    <!-- Title -->
                    <h3 class="text-base sm:text-lg font-semibold text-white mb-2 leading-snug">
                        {{ article.title_original }}
                    </h3>
                    {% if article.title_zh and article.title_zh != article.title_original %}
                    <p class="text-white/60 mb-3 text-sm sm:text-base">{{ article.title_zh }}</p>
                    {% endif %}
                    
                    <!-- Meta -->
                    <div class="flex flex-wrap items-center gap-3 sm:gap-4 text-xs sm:text-sm text-white/40 mb-4">
                        <span class="flex items-center gap-1">
                            <span>ğŸ“°</span> {{ article.source }}
                        </span>
                        <span class="flex items-center gap-1">
                            <span>ğŸ•</span> {{ article.published_at }}
                        </span>
                        {% if article.mentioned_people %}
                        <span class="flex items-center gap-1">
                            <span>ğŸ‘¤</span> {{ article.mentioned_people|join(', ') }}
                        </span>
                        {% endif %}
                    </div>
                    
                    <!-- Summary -->
                    <div class="bg-white/5 rounded-xl p-4 mb-4">
                        <h4 class="text-xs sm:text-sm font-semibold text-white/70 mb-2 flex items-center gap-1">
                            <span>ğŸ“‹</span> æ‘˜è¦
                        </h4>
                        <p class="text-white/60 leading-relaxed text-sm">{{ article.summary_zh[:500] }}{% if article.summary_zh|length > 500 %}...{% endif %}</p>
                    </div>
                    
                    <!-- Key Points -->
                    {% if article.key_points %}
                    <div class="mb-4">
                        <h4 class="text-xs sm:text-sm font-semibold text-white/70 mb-2 flex items-center gap-1">
                            <span>ğŸ”‘</span> å…³é”®è¦ç‚¹
                        </h4>
                        <ul class="space-y-2">
                            {% for point in article.key_points[:4] %}
                            <li class="text-sm text-white/60 flex items-start gap-2">
                                <span class="text-indigo-400 mt-1">â€¢</span>
                                <span>{{ point }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    <!-- Impact -->
                    {% if article.impact_analysis %}
                    <div class="bg-amber-500/10 border border-amber-500/20 rounded-xl p-4 mb-4">
                        <h4 class="text-xs sm:text-sm font-semibold text-amber-400 mb-2 flex items-center gap-1">
                            <span>ğŸ’¡</span> å½±å“åˆ†æ
                        </h4>
                        <p class="text-sm text-amber-200/70">{{ article.impact_analysis[:300] }}{% if article.impact_analysis|length > 300 %}...{% endif %}</p>
                    </div>
                    {% endif %}
                    
                    <!-- Link -->
                    <a href="{{ article.url }}" target="_blank" rel="noopener"
                       class="inline-flex items-center gap-1 text-sm text-indigo-400 hover:text-indigo-300 font-medium transition-colors group">
                        <span>ğŸ”—</span>
                        <span>é˜…è¯»åŸæ–‡</span>
                        <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                        </svg>
                    </a>
                </article>
                {% endfor %}
            </div>
        </section>
        {% endfor %}
        
        <!-- Predictions -->
        {% if briefing.get('predictions') %}
        <section class="glass rounded-2xl sm:rounded-3xl p-6 sm:p-8 mb-8 animate-slide-up">
            <h2 class="text-xl sm:text-2xl font-bold text-white mb-6 sm:mb-8 flex items-center gap-3">
                <span class="text-2xl sm:text-3xl">ğŸ¯</span>
                <span>æœªæ¥é¢„æµ‹</span>
            </h2>
            
            <div class="grid sm:grid-cols-2 gap-4 sm:gap-6">
                {% for timeframe, title in [('week', 'ğŸ“† æœªæ¥ä¸€å‘¨'), ('month', 'ğŸ“† æœªæ¥ä¸€ä¸ªæœˆ'), ('half_year', 'ğŸ“† æœªæ¥åŠå¹´'), ('year', 'ğŸ“† æœªæ¥ä¸€å¹´')] %}
                <div class="prediction-card rounded-xl p-5 sm:p-6">
                    <h3 class="font-semibold text-white mb-4 text-base sm:text-lg">{{ title }}</h3>
                    <div class="space-y-3">
                        {% for pred in briefing.predictions if pred.timeframe == timeframe %}
                        <div class="text-sm">
                            <span class="font-medium text-indigo-400">{{ pred.category_name or pred.category }}:</span>
                            <span class="text-white/60 ml-1">{{ pred.content[:100] }}{% if pred.content|length > 100 %}...{% endif %}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}
        
        {% elif briefing.get('markdown') %}
        <!-- Markdown Fallback -->
        <section class="glass rounded-2xl sm:rounded-3xl p-6 sm:p-8 mb-8 animate-slide-up">
            <div class="prose prose-invert max-w-none" id="markdown-content">
                {{ briefing.markdown | safe }}
            </div>
        </section>
        
        {% else %}
        <section class="glass rounded-2xl sm:rounded-3xl p-10 sm:p-16 text-center animate-slide-up">
            <div class="w-20 h-20 sm:w-24 sm:h-24 rounded-3xl bg-white/5 flex items-center justify-center mx-auto mb-6">
                <span class="text-4xl sm:text-5xl">ğŸ“­</span>
            </div>
            <p class="text-white/60 text-lg mb-2">è¯¥æ—¥æœŸæš‚æ— ç®€æŠ¥æ•°æ®</p>
            <a href="/" class="text-indigo-400 hover:text-indigo-300 text-sm transition-colors">â† è¿”å›é¦–é¡µ</a>
        </section>
        {% endif %}
        
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    const mdContent = document.getElementById('markdown-content');
    if (mdContent && mdContent.textContent.trim().startsWith('#')) {
        mdContent.innerHTML = marked.parse(mdContent.textContent);
    }
</script>
{% endblock %}
